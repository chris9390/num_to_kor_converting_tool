{% extends "base.html" %}
{% block title %}TEXT BOARD{% endblock %}
{% block head %}
    {{super()}}
    <script language="JavaScript">

        /*
        function delete_text(id, page){

            //location.href = "text_board/" + id + "/delete";
            location.replace("/text_board/delete?sent_id=" + id + "&page=" + page);
        }

        function create_text(page){

            location.href = "/text_board/create?page=" + page;      // GET 방식으로 Login.py의 text_create 함수로 전송
            //location.replace("/text_board/create");
        }
        */

        function order_text(id, page){
            // 1 이면 오름차순 정렬
            // 0 이면 내림차순 정렬
            var url = $(location).attr('href');
            var asc1_desc0 = getParameterByName(url, 'asc1_desc0');
            var search_msg = getParameterByName(url, 'search_msg');
            var article_id = getParameterByName(url, 'article_id');
            var before_selected_col = getParameterByName(url, 'col_name');
            var ordering = 1;

            if(id == before_selected_col){
                if(asc1_desc0 == 1) {
                    ordering = 0;
                }
                else {
                    ordering = 1;
                }
            }
            else {
                ordering = 1;
            }


            // 검색한 경우 ordering
            if(search_msg){
                //location.replace("/text_board/order?col_name=" + id + "&asc1_desc0=" + ordering + "&page=" + page + "&search_msg=" + search_msg);
                location.replace("/" + 'text_board' + "/order?article_id=" + article_id + "&col_name=" + id + "&asc1_desc0=" + ordering + "&page=" + page + "&search_msg=" + search_msg);
            }
            // 검색하지 않았을 경우 ordering
            else{
                //location.replace("/text_board/order?col_name=" + id + "&asc1_desc0=" + ordering + "&page=" + page);
                location.replace("/" + 'text_board' + "/order?article_id=" + article_id + "&col_name=" + id + "&asc1_desc0=" + ordering + "&page=" + page);
            }


        }


        function getParameterByName(url, param_name){
            var after_part = url.split("?")[1];
            var param_arr = after_part.split("&");

            for(var i = 0 ; i < param_arr.length ; i++)
            {
                var key_value = param_arr[i].split("=");

                if(key_value[0] === param_name)
                {
                    return key_value[1];
                }
            }
        }
    </script>


{% endblock %}

{% block nav %}
    <form class="form-inline" method="get" action="/text_board/search" role="search">
        <div class="col-md-10">
            <div class="form-group">
                <input type="text" class="form-control col-md-12" id="SearchText" name="search_msg" placeholder="텍스트를 검색해주세요.">
                <input type="hidden" name="page" value="{{page}}">
                <input type="hidden" name="article_id" value="{{article_id}}">
            </div>
        </div>

        <div class="form-group">
            <input type="submit" class="btn btn-primary" value="검색">
        </div>
    </form>

    <ul class="navbar-nav">
        <li><a class="nav-link" href="#">{{username}}님 접속중...</a></li>
        <li><a class="nav-link" href="{{url_for('logout')}}"><i class="fa-blink"><i class="fas fa-sign-out-alt"></i></i> 로그아웃</a></li>
    </ul>
{% endblock %}


{% block content %}

    <div class="container-fluid">


        <div class="row my-4">
            <div class="col text-left">
                <input type="button" class="btn btn-warning" value="기사 목록으로" onclick="location.href='/article_board?col_name=article_id&page={{article_board_page}}&asc1_desc0=1';">
            </div>

            {% if article_title is defined %}
            <div class="card border-dark">
                <div class="card-body">
                    <div class="card-title">기사 제목</div>

                    <div clsas="card-text">
                        <div class="col text-center font-weight-bold">
                            {{article_title}}
                        </div>
                    </div>
                </div>
            </div>
            {% endif %}

            <div class="col text-right">
                <input type="button" class="btn btn-primary" value="글쓰기" onclick="location.href='/text_board/create?page={{page}}';">
            </div>
        </div>




        <div class="row">
            <div class="col-2">
                {% include 'category.html' ignore missing %}
            </div>


            <div class="col-10">
                {{pagination.info}}
                {{pagination.links}}
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <div>
                                {% set cname_1 = 'fas fa-sort' %}
                                {% set cname_2 = 'fas fa-sort' %}
                                {% set cname_3 = 'fas fa-sort' %}
                                {% set cname_4 = 'fas fa-sort' %}
                                {% set cname_5 = 'fas fa-sort' %}

                                {% if asc1_desc0 == '0' and col_name == 'sent_id' %}
                                    {% set cname_1 = 'fas fa-sort-down' %}
                                    {% set cname_2 = 'fas fa-sort' %}
                                    {% set cname_3 = 'fas fa-sort' %}
                                    {% set cname_4 = 'fas fa-sort' %}
                                    {% set cname_5 = 'fas fa-sort' %}
                                {% elif asc1_desc0 == '1' and col_name == 'sent_id' %}
                                    {% set cname_1 = 'fas fa-sort-up' %}
                                    {% set cname_2 = 'fas fa-sort' %}
                                    {% set cname_3 = 'fas fa-sort' %}
                                    {% set cname_4 = 'fas fa-sort' %}
                                    {% set cname_5 = 'fas fa-sort' %}

                                {% elif asc1_desc0 == '0' and col_name == 'article_id' %}
                                    {% set cname_2 = 'fas fa-sort-down' %}
                                    {% set cname_1 = 'fas fa-sort' %}
                                    {% set cname_3 = 'fas fa-sort' %}
                                    {% set cname_4 = 'fas fa-sort' %}
                                    {% set cname_5 = 'fas fa-sort' %}
                                {% elif asc1_desc0 == '1' and col_name == 'article_id' %}
                                    {% set cname_2 = 'fas fa-sort-up' %}
                                    {% set cname_1 = 'fas fa-sort' %}
                                    {% set cname_3 = 'fas fa-sort' %}
                                    {% set cname_4 = 'fas fa-sort' %}
                                    {% set cname_5 = 'fas fa-sort' %}

                                {% elif asc1_desc0 == '0' and col_name == 'article_collected_date' %}
                                    {% set cname_3 = 'fas fa-sort-down' %}
                                    {% set cname_1 = 'fas fa-sort' %}
                                    {% set cname_2 = 'fas fa-sort' %}
                                    {% set cname_4 = 'fas fa-sort' %}
                                    {% set cname_5 = 'fas fa-sort' %}
                                {% elif asc1_desc0 == '1' and col_name == 'article_collected_date' %}
                                    {% set cname_3 = 'fas fa-sort-up' %}
                                    {% set cname_1 = 'fas fa-sort' %}
                                    {% set cname_2 = 'fas fa-sort' %}
                                    {% set cname_4 = 'fas fa-sort' %}
                                    {% set cname_5 = 'fas fa-sort' %}

                                {% elif asc1_desc0 == '0' and col_name == 'sent_modified_date' %}
                                    {% set cname_4 = 'fas fa-sort-down' %}
                                    {% set cname_1 = 'fas fa-sort' %}
                                    {% set cname_2 = 'fas fa-sort' %}
                                    {% set cname_3 = 'fas fa-sort' %}
                                    {% set cname_5 = 'fas fa-sort' %}
                                {% elif asc1_desc0 == '1' and col_name == 'sent_modified_date' %}
                                    {% set cname_4 = 'fas fa-sort-up' %}
                                    {% set cname_1 = 'fas fa-sort' %}
                                    {% set cname_2 = 'fas fa-sort' %}
                                    {% set cname_3 = 'fas fa-sort' %}
                                    {% set cname_5 = 'fas fa-sort' %}

                                {% elif asc1_desc0 == '0' and col_name == 'sent_converted_count' %}
                                    {% set cname_5 = 'fas fa-sort-down' %}
                                    {% set cname_1 = 'fas fa-sort' %}
                                    {% set cname_2 = 'fas fa-sort' %}
                                    {% set cname_3 = 'fas fa-sort' %}
                                    {% set cname_4 = 'fas fa-sort' %}
                                {% elif asc1_desc0 == '1' and col_name == 'sent_converted_count' %}
                                    {% set cname_5 = 'fas fa-sort-up' %}
                                    {% set cname_1 = 'fas fa-sort' %}
                                    {% set cname_2 = 'fas fa-sort' %}
                                    {% set cname_3 = 'fas fa-sort' %}
                                    {% set cname_4 = 'fas fa-sort' %}
                                {% endif %}
                                </div>
                                <th style="width : 11%" class="text-center">문장 번호<button class="btn" id="sent_id" onclick="order_text(id,'{{page}}')"><i class='{{cname_1}}'></i></button></th>
                                <th class="text-center">텍스트</th>
                                <th style="width : 11%" class="text-center">기사 번호<button class="btn" id="article_id" onclick="order_text(id, '{{page}}')"><i class='{{cname_2}}'></i></button></th>
                                <th style="width : 15%" class="text-center">기사 수집일<button class="btn" id="article_collected_date" onclick="order_text(id, '{{page}}')"><i class='{{cname_3}}'></i></button></th>
                                <th style="width : 15%" class="text-center">텍스트 편집일<button class="btn" id="sent_modified_date" onclick="order_text(id, '{{page}}')"><i class='{{cname_4}}'></i></button></th>
                                <th style="width : 11%" class="text-center">수정 횟수<button class="btn" id="sent_converted_count" onclick="order_text(id, '{{page}}')"><i class='{{cname_5}}'></i></button></th>
                                <th></th>
                            </tr>
                        </thead>

                        <tbody>
                        {% for row in board_total %}
                            <tr>
                                <td class="text-center">{{row.sent_id}}</td>

                                {% if row.sent_confirm == 1 %}
                                <td>
                                    {% if search_msg is defined %}
                                        <a href="/text_board/edit?article_id={{article_id}}&sent_id={{row.sent_id}}&page={{page}}&search_msg={{search_msg}}">{{row.sent_converted}}</a>
                                    {% else %}
                                        <a href="/text_board/edit?article_id={{article_id}}&sent_id={{row.sent_id}}&page={{page}}">{{row.sent_converted}}</a>
                                    {% endif %}
                                </td>
                                {% else %}
                                <td>
                                    {% if search_msg is defined %}
                                        <a href="/text_board/edit?article_id={{article_id}}&sent_id={{row.sent_id}}&page={{page}}&search_msg={{search_msg}}">{{row.sent_original}}</a>
                                    {% else %}
                                        <a href="/text_board/edit?article_id={{article_id}}&sent_id={{row.sent_id}}&page={{page}}">{{row.sent_original}}</a>
                                    {% endif %}
                                </td>
                                {% endif %}

                                <td class="text-center">{{row.article_id}}</td>
                                {% if row.article_collected_date|string == '1900-01-01 00:00:00' %}
                                    <td class="text-center">-</td>
                                {% else %}
                                    <td class="text-center">{{row.article_collected_date}}</td>
                                {% endif %}

                                {% if row.sent_modified_date|string == '1900-01-01 00:00:00' %}
                                    <td class="text-center">-</td>
                                {% else %}
                                    <td class="text-center">{{row.sent_modified_date}}</td>
                                {% endif %}

                                <td class="text-center">{{row.sent_converted_count}}</td>
                                <!--
                                <td class="text-center"><input type="button" class="btn btn-danger btn-sm" id="delete" value="삭제" onclick="location.replace('/text_board/delete?sent_id={{row.sent_id}}&page={{page}}')"></td>
                                -->
                                <form method="post" action="/text_board/delete">
                                    <td class="text-center">
                                        <input type="submit" class="btn btn-danger btn-sm" id="delete" value="삭제">
                                        <input type="hidden" name="sent_id" value="{{row.sent_id}}">
                                        <input type="hidden" name="page" value="{{page}}">
                                    </td>
                                </form>

                            </tr>
                        {% endfor %}

                        </tbody>
                    </table>
                {{pagination.links}}


            </div>
        </div>



        <div class="row">
            <div class="col text-left">
                <input type="button" class="btn btn-warning" value="기사 목록으로" onclick="location.href='/article_board?col_name=article_id&page={{article_board_page}}&asc1_desc0=1';">
            </div>

            <div class="col text-right">
                <input type="button" class="btn btn-primary" value="글쓰기" onclick="location.href='/text_board/create?page={{page}}';">
            </div>
        </div>

    </div>
{% endblock %}
